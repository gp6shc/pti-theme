/*---------------------------------------------------------------------------------------------

@author       Constantin Saguin - @brutaldesign
@link            http://csag.co
@github        http://github.com/One-com/shinybox
@version     1.2.1
@license      MIT License

----------------------------------------------------------------------------------------------*/
!function(i,t,$){$.shinybox=function(e,n){var s={useCSS:!0,initialIndexOnArray:0,hideBarsDelay:3e3,videoMaxWidth:1140,vimeoColor:"CCCCCC",beforeOpen:null,afterClose:null,closePlacement:"bottom",captionPlacement:"top",navigationPlacement:"bottom"},o=this,a=[],r,d=e.selector,l=$(d),h="undefined"!=typeof t.createTouch||"ontouchstart"in i||"onmsgesturechange"in i||navigator.msMaxTouchPoints,c=!!i.SVGSVGElement,u=i.innerWidth?i.innerWidth:$(i).width(),b=i.innerHeight?i.innerHeight:$(i).height(),v="";o.settings={},o.init=function(){o.settings=$.extend({},s,n);var t="",h="";"top"===o.settings.closePlacement?t+='<a id="shinybox-close"></a>':"bottom"===o.settings.closePlacement&&(h+='<a id="shinybox-close"></a>'),"top"===o.settings.captionPlacement?t+='<div id="shinybox-caption"></div>':"bottom"===o.settings.captionPlacement&&(h+='<div id="shinybox-caption"></div>'),"top"===o.settings.navigationPlacement?t+='<a id="shinybox-prev"></a><a id="shinybox-next"></a>':"bottom"===o.settings.navigationPlacement&&(h+='<a id="shinybox-prev"></a><a id="shinybox-next"></a>'),v='<div id="shinybox-overlay"><div id="shinybox-slider"></div><div id="shinybox-top">'+t+'</div><div id="shinybox-bottom">'+h+"</div></div>",$.isArray(e)?(a=e,y.target=$(i),y.init(o.settings.initialIndexOnArray)):l.click(function(i){a=[];var t,e,n;n||(e="rel",n=$(this).attr(e)),r=n&&""!==n&&"nofollow"!==n?l.filter("["+e+'="'+n+'"]'):$(d),r.each(function(){var i=null,t=null;$(this).attr("title")&&(i=$(this).attr("title")),$(this).attr("href")&&(t=$(this).attr("href")),a.push({href:t,title:i})}),t=r.index($(this)),i.preventDefault(),i.stopPropagation(),y.target=$(i.target),y.init(t)})},o.refresh=function(){$.isArray(e)||(y.destroy(),r=$(d),y.actions())};var y={init:function(i){o.settings.beforeOpen&&o.settings.beforeOpen(),this.target.trigger("shinybox-start"),$.shinybox.isOpen=!0,this.build(),this.openSlide(i),this.openMedia(i),this.preloadMedia(i+1),this.preloadMedia(i-1)},build:function(){var i=this;if($("body").append(v),i.doCssTrans()&&($("#shinybox-slider").css({"-webkit-transition":"left 0.4s ease","-moz-transition":"left 0.4s ease","-o-transition":"left 0.4s ease","-khtml-transition":"left 0.4s ease",transition:"left 0.4s ease"}),$("#shinybox-overlay").css({"-webkit-transition":"opacity 1s ease","-moz-transition":"opacity 1s ease","-o-transition":"opacity 1s ease","-khtml-transition":"opacity 1s ease",transition:"opacity 1s ease"}),$("#shinybox-bottom, #shinybox-top").css({"-webkit-transition":"0.5s","-moz-transition":"0.5s","-o-transition":"0.5s","-khtml-transition":"0.5s",transition:"0.5s"})),c){var t=$("#shinybox-close").css("background-image");t=t.replace("png","svg"),$("#shinybox-prev,#shinybox-next,#shinybox-close").css({"background-image":t})}$.each(a,function(){$("#shinybox-slider").append('<div class="slide"></div>')}),i.setDim(),i.actions(),i.keyboard(),i.gesture(),i.animBars(),i.resize()},setDim:function(){var t,e,n={};"onorientationchange"in i?i.addEventListener("orientationchange",function(){0===i.orientation?(t=u,e=b):(90===i.orientation||-90===i.orientation)&&(t=b,e=u)},!1):(t=i.innerWidth?i.innerWidth:$(i).width(),e=i.innerHeight?i.innerHeight:$(i).height()),n={width:t,height:e},$("#shinybox-overlay").css(n),$("#shinybox-slider").css(0===o.settings.hideBarsDelay?{top:"50px",height:e-100+"px"}:{top:0,height:"100%"})},resize:function(){var t=this;$(i).resize(function(){t.setDim()}).resize()},supportTransition:function(){for(var i="transition WebkitTransition MozTransition OTransition msTransition KhtmlTransition".split(" "),e=0;e<i.length;e+=1)if(void 0!==t.createElement("div").style[i[e]])return i[e];return!1},doCssTrans:function(){return o.settings.useCSS&&this.supportTransition()?!0:void 0},gesture:function(){if(h){var i=this,t=null,e=10,n={},s={},o=$("#shinybox-top, #shinybox-bottom");o.addClass("visible-bars"),i.setTimeout(),$("body").bind("touchstart",function(i){return $(this).addClass("touching"),s=i.originalEvent.targetTouches[0],n.pageX=i.originalEvent.targetTouches[0].pageX,$(".touching").bind("touchmove",function(i){i.preventDefault(),i.stopPropagation(),s=i.originalEvent.targetTouches[0]}),!1}).bind("touchend",function(a){a.preventDefault(),a.stopPropagation(),t=s.pageX-n.pageX,t>=e?i.getPrev():-e>=t?i.getNext():o.hasClass("visible-bars")?(i.clearTimeout(),i.hideBars()):(i.showBars(),i.setTimeout()),$(".touching").off("touchmove").removeClass("touching")})}},setTimeout:function(){if(o.settings.hideBarsDelay>0){var t=this;t.clearTimeout(),t.timeout=i.setTimeout(function(){t.hideBars()},o.settings.hideBarsDelay)}},clearTimeout:function(){i.clearTimeout(this.timeout),this.timeout=null},showBars:function(){var i=$("#shinybox-top, #shinybox-bottom");this.doCssTrans()?i.addClass("visible-bars"):($("#shinybox-top").animate({top:0},500),$("#shinybox-bottom").animate({bottom:0},500),setTimeout(function(){i.addClass("visible-bars")},1e3))},hideBars:function(){var i=$("#shinybox-top, #shinybox-bottom");this.doCssTrans()?i.removeClass("visible-bars"):($("#shinybox-top").animate({top:"-50px"},500),$("#shinybox-bottom").animate({bottom:"-50px"},500),setTimeout(function(){i.removeClass("visible-bars")},1e3))},animBars:function(){var i=this,t=$("#shinybox-top, #shinybox-bottom");t.addClass("visible-bars"),i.setTimeout(),$("#shinybox-slider").click(function(e){t.hasClass("visible-bars")||(i.showBars(),i.setTimeout())}),$("#shinybox-bottom").hover(function(){i.showBars(),t.addClass("force-visible-bars"),i.clearTimeout()},function(){t.removeClass("force-visible-bars"),i.setTimeout()})},keyboard:function(){var t=this;$(i).bind("keyup",function(i){i.preventDefault(),i.stopPropagation(),37===i.keyCode?t.getPrev():39===i.keyCode?t.getNext():27===i.keyCode&&t.closeSlide()})},actions:function(){var i=this;a.length<2?$("#shinybox-prev, #shinybox-next").hide():($("#shinybox-prev").bind("click touchend",function(t){t.preventDefault(),t.stopPropagation(),i.getPrev(),i.setTimeout()}),$("#shinybox-next").bind("click touchend",function(t){t.preventDefault(),t.stopPropagation(),i.getNext(),i.setTimeout()})),$("#shinybox-close").bind("click touchend",function(t){i.closeSlide()}),$("#shinybox-slider .slide").bind("click",function(t){t.target===this&&i.closeSlide()})},setSlide:function(i,t){t=t||!1;var e=$("#shinybox-slider");this.doCssTrans()?e.css({left:100*-i+"%"}):e.animate({left:100*-i+"%"}),$("#shinybox-slider .slide").removeClass("current"),$("#shinybox-slider .slide").eq(i).addClass("current"),this.setTitle(i),t&&e.fadeIn(),$("#shinybox-prev, #shinybox-next").removeClass("disabled"),0===i?$("#shinybox-prev").addClass("disabled"):i===a.length-1&&$("#shinybox-next").addClass("disabled")},openSlide:function(t){$("html").addClass("shinybox"),$(i).trigger("resize"),this.setSlide(t,!0)},preloadMedia:function(i){var t=this,e=null;void 0!==a[i]&&(e=a[i].href),t.isVideo(e)?t.openMedia(i):setTimeout(function(){t.openMedia(i)},300)},openMedia:function(i){var t=this,e=null;if(void 0!==a[i]&&(e=a[i].href),0>i||i>=a.length)return!1;var n=$("#shinybox-slider .slide").eq(i);t.isVideo(e)?n.html(t.getVideo(e)):t.isPDF(e)?n.html(t.getPDF(e)):(n.html('<div class="loading"></div>'),t.loadMedia(e,function(){n.html(this)}))},setTitle:function(i,t){var e=null;$("#shinybox-caption").empty(),void 0!==a[i]&&(e=a[i].title),e&&$("#shinybox-caption").text(e)},isPDF:function(i){return i&&i.match(/\.pdf(?:\?|$)/)?!0:void 0},getPDF:function(i){var t='<iframe src="'+i+'">';return'<div class="shinybox-pdf-container"><div class="shinybox-pdf">'+t+"</div></div>"},isVideo:function(i){return i&&(i.match(/youtube\.com\/watch\?v=([a-zA-Z0-9\-_]+)/)||i.match(/vimeo\.com\/([0-9]*)/))?!0:void 0},getVideo:function(i){var t="",e="",n=i.match(/watch\?v=([a-zA-Z0-9\-_]+)/),s=i.match(/vimeo\.com\/([0-9]*)/);return n?t='<iframe width="560" height="315" src="//www.youtube.com/embed/'+n[1]+'" frameborder="0" allowfullscreen></iframe>':s&&(t='<iframe width="560" height="315"  src="http://player.vimeo.com/video/'+s[1]+"?byline=0&amp;portrait=0&amp;color="+o.settings.vimeoColor+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'),'<div class="shinybox-video-container" style="max-width:'+o.settings.videomaxWidth+'px"><div class="shinybox-video">'+t+"</div></div>"},loadMedia:function(i,t){if(!this.isVideo(i)){var e=$("<img>").on("load",function(){t.call(e)});e.attr("src",i)}},getNext:function(){var i=this,t=$("#shinybox-slider .slide").index($("#shinybox-slider .slide.current"));t+1<a.length?(t+=1,i.setSlide(t),i.preloadMedia(t+1)):($("#shinybox-slider").addClass("rightSpring"),setTimeout(function(){$("#shinybox-slider").removeClass("rightSpring")},500))},getPrev:function(){var i=$("#shinybox-slider .slide").index($("#shinybox-slider .slide.current"));i>0?(i-=1,this.setSlide(i),this.preloadMedia(i-1)):($("#shinybox-slider").addClass("leftSpring"),setTimeout(function(){$("#shinybox-slider").removeClass("leftSpring")},500))},closeSlide:function(){$("html").removeClass("shinybox"),$(i).trigger("resize"),this.destroy()},destroy:function(){$(i).unbind("keyup"),$("body").unbind("touchstart"),$("body").unbind("touchmove"),$("body").unbind("touchend"),$("#shinybox-slider").unbind(),$("#shinybox-overlay").remove(),$.isArray(e)||e.removeData("_shinybox"),this.target&&this.target.trigger("shinybox-destroy"),$.shinybox.isOpen=!1,o.settings.afterClose&&o.settings.afterClose()}};o.init()},$.fn.shinybox=function(i){if(!$.data(this,"_shinybox")){var t=new $.shinybox(this,i);this.data("_shinybox",t)}return this.data("_shinybox")}}(window,document,jQuery);